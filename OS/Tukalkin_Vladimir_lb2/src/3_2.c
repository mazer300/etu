/*
 * Программа для анализа функции wait() и waitpid() в контексте завершения процессов.
 * 
 * Задание: 3.2. Проанализируйте значение, возвращаемое функцией wait(&status). Как связана wait() с SIGCHLD. 
 * Также предложите эксперимент, позволяющий родителю отслеживать подмножество порожденных потомков с использованием функций waitpid().
 *
 * Программа порождает два дочерних процесса, которые выполняют свою работу и завершаются. Родительский процесс 
 * использует функции wait() и waitpid() для ожидания завершения дочерних процессов и получения статуса их завершения.
 * 
 * 1. Родитель создает два дочерних процесса с помощью fork().
 * 2. Каждый дочерний процесс выполняет небольшую задержку, эмулируя выполнение работы.
 * 3. Родительский процесс использует wait() для ожидания завершения одного из процессов и waitpid() для ожидания другого.
 * 4. Программа анализирует и выводит статус завершения процессов.
 * 
 * Компиляция:
 * gcc father.c -o father
 * 
 * Запуск:
 * ./father
 */

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/wait.h>

int main() {
    pid_t pid1, pid2;
    int status;

    pid1 = fork();
    if (pid1 == 0) {
        // Дочерний процесс 1
        printf("Son 1 (PID: %d) работает...\n", getpid());
        sleep(2); // Эмулируем выполнение
        printf("Son 1 завершен\n");
        exit(0);
    }

    pid2 = fork();
    if (pid2 == 0) {
        // Дочерний процесс 2
        printf("Son 2 (PID: %d) работает...\n", getpid());
        sleep(3); // Эмулируем выполнение
        printf("Son 2 завершен\n");
        exit(0);
    }

    // Родительский процесс использует wait() для ожидания завершения процессов
    printf("Father (PID: %d) ожидает завершение потомков...\n", getpid());

    // Используем wait для ожидания первого потомка
    wait(&status); // Ожидаем завершения одного из процессов
    if (WIFEXITED(status)) {
        printf("Процесс завершен с кодом: %d\n", WEXITSTATUS(status));
    }

    // Используем waitpid для ожидания второго потомка (с указанным PID)
    waitpid(pid2, &status, 0); // Ожидаем завершение процесса с pid2
    if (WIFEXITED(status)) {
        printf("Процесс завершен с кодом: %d\n", WEXITSTATUS(status));
    }

    printf("Отец завершил выполнение.\n");
    return 0;
}
