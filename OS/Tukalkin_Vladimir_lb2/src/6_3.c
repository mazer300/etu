/*
 * Назначение программы:
 * Демонстрация наследования сигналов между родительским и дочерним процессами после вызова fork().
 * Родительский процесс устанавливает обработчик для сигнала SIGUSR1 и посылает этот сигнал
 * дочернему процессу, чтобы тот его принял.
 *
 * Основные функции:
 * - signal() — установка обработчика сигнала;
 * - fork() — создание дочернего процесса;
 * - kill() — отправка сигнала процессу;
 * - pause() — ожидание получения сигнала;
 * - wait() — ожидание завершения дочернего процесса.
 *
 * Родительский процесс посылает сигнал дочернему, и тот его обрабатывает с помощью заранее установленного обработчика.
 */

#include <stdio.h>
#include <signal.h>
#include <unistd.h>
#include <sys/wait.h>

void signal_handler(int sig) {
    printf("Получен сигнал %d\n", sig);
}

int main() {
    // Устанавливаем обработчик сигнала SIGUSR1
    signal(SIGUSR1, signal_handler);

    pid_t pid = fork();
    if (pid == 0) {
        // Дочерний процесс
        printf("Дочерний процесс ожидает сигнал\n");
        pause();  // Ожидаем сигнал
    } else if (pid > 0) {
        // Родительский процесс
        printf("Родительский процесс посылает сигнал дочернему\n");
        sleep(1);  // Задержка, чтобы дочерний процесс успел начать ожидание
        kill(pid, SIGUSR1);  // Отправляем сигнал дочернему процессу
        wait(NULL);  // Ожидаем завершения дочернего процесса
    } else {
        perror("Ошибка fork");
        return 1;
    }

    return 0;
}
